<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSA JAMB PRO - Subject Switcher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --jamb-blue: #0d47a1; --accent: #ffd600; --bg: #f4f7f6; }
        body { background: var(--bg); font-family: 'Segoe UI', sans-serif; padding-bottom: 220px; }
        .header { background: var(--jamb-blue); color: white; padding: 12px; border-bottom: 4px solid var(--accent); position: sticky; top: 0; z-index: 1000; }
        .option { display: block; width: 100%; padding: 12px; margin-bottom: 8px; border: 1.5px solid #ddd; border-radius: 8px; text-align: left; background: white; }
        .option.selected { background: var(--jamb-blue); color: white; border-color: var(--jamb-blue); }
        
        /* BOTTOM PANEL */
        .bottom-panel { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 2px solid #ddd; padding: 10px; z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.1); }
        .subject-nav { max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
        .sub-btn { width: 100%; text-align: left; margin-bottom: 2px; border-radius: 4px; border: 1px solid #eee; padding: 8px 15px; background: #fff; }
        .sub-btn.active { background: #007bff; color: white; font-weight: bold; }
        
        .passage-box { background: #fffbe6; border-left: 5px solid #ffc107; padding: 12px; margin-bottom: 15px; font-style: italic; font-size: 0.95rem; }
        #calc-box { display:none; position: fixed; top: 70px; right: 10px; width: 200px; background: #222; padding: 10px; border-radius: 10px; z-index: 2000; }
    </style>
</head>
<body>

<div class="header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">ðŸŽ“ FSA JAMB PRO</h5>
    <div id="timer" class="fw-bold">02:00:00</div>
    <button class="btn btn-sm btn-warning fw-bold" onclick="toggleCalc()">CALC</button>
</div>

<div id="calc-box" class="shadow">
    <input type="text" id="calc-display" class="form-control mb-2 text-end" readonly>
    <div class="d-flex flex-wrap justify-content-center">
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('7')">7</button>
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('8')">8</button>
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('9')">9</button>
        <button class="btn btn-sm btn-danger m-1" style="width:35px" onclick="calcInput('C')">C</button>
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('4')">4</button>
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('5')">5</button>
        <button class="btn btn-sm btn-outline-light m-1" style="width:35px" onclick="calcInput('6')">6</button>
        <button class="btn btn-sm btn-warning m-1" style="width:35px" onclick="calcInput('*')">Ã—</button>
        <button class="btn btn-sm btn-success m-1" style="width:80px" onclick="calcInput('=')">=</button>
    </div>
</div>

<div class="container mt-3">
    <div id="exam-area">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 id="current-subject-name" class="text-primary fw-bold mb-0">English</h6>
            <span id="q-count" class="badge bg-secondary">Q 1 of 60</span>
        </div>
        
        <div class="card p-3 shadow-sm border-0">
            <div id="q-content">Loading questions...</div>
            
            <div class="d-flex justify-content-between mt-3">
                <button class="btn btn-sm btn-outline-secondary px-4" onclick="changeQ(-1)">Previous</button>
                <button class="btn btn-sm btn-primary px-4" onclick="changeQ(1)">Next</button>
            </div>
        </div>
    </div>
</div>

<div class="bottom-panel">
    <small class="text-muted fw-bold d-block mb-1">Subjects</small>
    <div class="subject-nav" id="sub-list">
        </div>
    <button class="btn btn-danger w-100 fw-bold mt-1" onclick="submitExam()">SUBMIT ALL</button>
</div>

<script>
    const subjects = ["English", "Physics", "Chemistry", "Biology", "Government", "Crk", "Mathematics", "Economics", "Commerce", "Accounting"];
    let examData = {};
    let currentSub = "English";
    let currentIdx = 0;
    let userAnswers = {};

    // 1. Initialize the Subject List at the bottom
    function initApp() {
        const list = document.getElementById('sub-list');
        list.innerHTML = subjects.map(s => `
            <button class="sub-btn ${s === currentSub ? 'active' : ''}" id="btn-${s}" onclick="switchSub('${s}')">
                ${s}
            </button>
        `).join('');
        loadAllData();
        startTimer(7200);
    }

    // 2. Load all JSON files at once
    async function loadAllData() {
        for (let s of subjects) {
            try {
                const response = await fetch(`${s.toLowerCase()}.json?v=${Date.now()}`);
                examData[s] = await response.json();
                userAnswers[s] = {};
            } catch (e) { console.log("Missing: " + s); }
        }
        renderQuestion();
    }

    // 3. Switch between subjects
    function switchSub(sName) {
        if (!examData[sName]) return alert("File for " + sName + " is missing!");
        currentSub = sName;
        currentIdx = 0;
        
        // Update UI buttons
        document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${sName}`).classList.add('active');
        
        renderQuestion();
    }

    // 4. Render the current question
    function renderQuestion() {
        const qData = examData[currentSub][currentIdx];
        document.getElementById('current-subject-name').innerText = currentSub;
        document.getElementById('q-count').innerText = `Q ${currentIdx + 1} of ${examData[currentSub].length}`;
        
        let html = qData.p ? `<div class="passage-box">${qData.p}</div>` : "";
        html += `<p class="fw-bold">${qData.q}</p>`;
        
        qData.options.forEach((opt, i) => {
            const isSel = userAnswers[currentSub][currentIdx] === i;
            html += `<button class="option ${isSel?'selected':''}" onclick="answer(${i})">
                <b>${String.fromCharCode(65+i)}.</b> ${opt}
            </button>`;
        });
        
        document.getElementById('q-content').innerHTML = html;
    }

    function answer(i) { userAnswers[currentSub][currentIdx] = i; renderQuestion(); }
    function changeQ(dir) { 
        if(currentIdx + dir >= 0 && currentIdx + dir < examData[currentSub].length) {
            currentIdx += dir; renderQuestion();
        }
    }

    function submitExam() {
        if(confirm("Are you sure you want to submit all subjects?")) {
            let total = 0;
            subjects.forEach(s => {
                if(examData[s]) {
                    let correct = 0;
                    examData[s].forEach((q, i) => { if(userAnswers[s][i] === q.a) correct++; });
                    total += (correct / examData[s].length) * 100;
                }
            });
            alert("Finished!\nJAMB Aggregate: " + Math.round(total));
            location.reload();
        }
    }

    function startTimer(t) {
        setInterval(() => {
            t--;
            let h=Math.floor(t/3600), m=Math.floor((t%3600)/60), s=t%60;
            document.getElementById('timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);
    }

    function toggleCalc() {
        const c = document.getElementById('calc-box');
        c.style.display = c.style.display === 'block' ? 'none' : 'block';
    }

    function calcInput(v) {
        const d = document.getElementById('calc-display');
        if(v==='C') d.value=''; else if(v==='=') d.value=eval(d.value); else d.value+=v;
    }

    initApp();
</script>
</body>
</html>
