<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSA JAMB CBT Pro Practice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0d6efd; --success: #198754; --danger: #dc3545; --dark: #0f111a; --card: #1e1f2b; --text: #ffffff; }
        body.light-mode { --dark: #f8f9fa; --card: #ffffff; --text: #212529; }
        body { background: var(--dark); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; transition: 0.3s; }
        
        .app-container { min-height: 100vh; padding-bottom: 100px; }
        .app-section { display: none; padding: 20px; }
        #dashboard-view { display: block; }

        /* Passage Styling */
        .passage-box { 
            background: rgba(13, 110, 253, 0.1); 
            border-left: 4px solid var(--primary); 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            max-height: 250px; 
            overflow-y: auto; 
            font-size: 0.95rem; 
            line-height: 1.6;
            display: none;
        }

        .header-box { padding: 25px 20px; background: linear-gradient(135deg, #2e3075, #1a1d4f); border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; color: white; }
        .countdown-timer { background: rgba(255, 255, 255, 0.1); padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; border: 1px solid rgba(255,255,255,0.2); }
        .navbar-top { background: #198754; padding: 10px 20px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; font-weight: bold; color: white; }
        
        .question-palette { background: var(--card); padding: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 5px; max-height: 120px; overflow-y: auto; border-radius: 10px; }
        .palette-btn { width: 35px; height: 35px; border-radius: 50%; border: none; cursor: pointer; font-size: 0.8rem; background: #6c757d; color: white; }
        .palette-btn.answered { background: var(--success); }
        .palette-btn.current { border: 2px solid var(--primary); font-weight: bold; }
        .palette-btn.flagged { background: orange; }

        .question-box { background: var(--card); border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .option-btn { background: rgba(13, 110, 253, 0.05); border: 1px solid rgba(13, 110, 253, 0.2); border-radius: 12px; padding: 15px; margin: 8px 0; width: 100%; text-align: left; color: var(--text); transition: 0.2s; }
        .option-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .nav-bottom { position: fixed; bottom: 0; width: 100%; background: linear-gradient(135deg, #2e3075, #1a1d4f); display: flex; justify-content: space-around; padding: 12px 0; border-top-left-radius: 25px; border-top-right-radius: 25px; z-index: 1000; }
        .nav-link { color: rgba(255,255,255,0.6); text-decoration: none; font-size: 0.7rem; text-align: center; cursor: pointer; flex: 1; }
        .nav-link.active { color: white; font-weight: bold; }

        .subject-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
        .subject-card { background: var(--card); border-radius: 18px; padding: 20px; text-align: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.05); }
    </style>
</head>
<body>
<div class="app-container">
    <div id="dashboard-view" class="app-section">
        <div class="header-box">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-1 fw-bold">Hello, Scholar!</h5>
                    <div id="jamb-countdown" class="countdown-timer"></div>
                </div>
                <div class="d-flex gap-3">
                    <i class="fas fa-moon fs-4" style="cursor:pointer;" onclick="toggleTheme()"></i>
                    <i class="fas fa-chart-line fs-4" style="cursor:pointer;" onclick="showSection('stats-view')"></i>
                </div>
            </div>
        </div>
        <div class="px-3">
            <h6 class="fw-bold mb-3 mt-4">Select Subject</h6>
            <div id="subject-grid" class="subject-grid"></div>
        </div>
    </div>

    <div id="exam-hall-view" class="app-section">
        <div class="navbar-top">
            <span id="sub-label" class="badge bg-primary"></span>
            <div class="d-flex align-items-center gap-3">
                <span id="exam-timer" class="badge bg-light text-dark fs-6">02:00:00</span>
                <button class="btn btn-sm btn-light" onclick="submitExam(true)">End</button>
            </div>
        </div>
        <div class="question-box">
            <div id="passage-container" class="passage-box"></div>
            <div class="d-flex justify-content-between mb-3">
                <span class="badge bg-secondary" id="q-counter">Q1</span>
                <button class="btn btn-warning btn-sm" onclick="flagQuestion()">Flag</button>
            </div>
            <div id="question-text" class="fs-5 fw-semibold mb-4"></div>
            <div id="options-container"></div>
        </div>
        <div class="question-palette" id="question-palette"></div>
        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-outline-primary rounded-pill px-4" onclick="prevQuestion()"><i class="fas fa-arrow-left"></i></button>
            <button class="btn btn-success rounded-pill px-5" onclick="submitExam()">Submit</button>
            <button class="btn btn-outline-primary rounded-pill px-4" onclick="nextQuestion()"><i class="fas fa-arrow-right"></i></button>
        </div>
    </div>

    <div id="stats-view" class="app-section">
        <h5 class="fw-bold mb-4">History</h5>
        <div id="history-list"></div>
        <button class="btn btn-primary w-100 mt-3" onclick="showSection('dashboard-view')">Back Home</button>
    </div>

    <div class="nav-bottom">
        <a class="nav-link active" onclick="showSection('dashboard-view', this)"><i class="fas fa-home d-block fs-3"></i><span>Home</span></a>
        <a class="nav-link" onclick="showSection('stats-view', this)"><i class="fas fa-poll d-block fs-3"></i><span>Stats</span></a>
    </div>
</div>

<script>
    const allSubjects = [
        { id: "english", name: "English", icon: "fas fa-spell-check", color: "#9c27b0" },
        { id: "mathematics", name: "Maths", icon: "fas fa-divide", color: "#f44336" },
        { id: "biology", name: "Biology", icon: "fas fa-dna", color: "#8bc34a" },
        { id: "physics", name: "Physics", icon: "fas fa-atom", color: "#2196f3" },
        { id: "chemistry", name: "Chemistry", icon: "fas fa-flask", color: "#00bcd4" },
        { id: "economics", name: "Economics", icon: "fas fa-chart-line", color: "#3f51b5" },
        { id: "government", name: "Government", icon: "fas fa-landmark", color: "#607d8b" },
        { id: "literature", name: "Literature", icon: "fas fa-book", color: "#e91e63" },
        { id: "commerce", name: "Commerce", icon: "fas fa-store", color: "#ff9800" },
        { id: "crk", name: "CRK", icon: "fas fa-cross", color: "#795548" },
        { id: "accounting", name: "Accounting", icon: "fas fa-calculator", color: "#4caf50" }
    ];

    let currentQuestions = [], currentSubject = '', currentQuestionIndex = 0, examTimer, timeLeft = 7200, userSelections = {}, flags = {};

    window.onload = () => {
        populateSubjects();
        updateCountdown();
        if(localStorage.getItem('theme') === 'light') toggleTheme();
    };

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        const icon = document.querySelector('.fa-moon, .fa-sun');
        icon.classList.toggle('fa-moon');
        icon.classList.toggle('fa-sun');
        localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
    }

    function updateCountdown() {
        const days = Math.floor((new Date("April 18, 2026") - new Date()) / (1000 * 60 * 60 * 24));
        document.getElementById("jamb-countdown").innerText = `${days} Days to JAMB 2026`;
    }

    function populateSubjects() {
        document.getElementById('subject-grid').innerHTML = allSubjects.map(s => `
            <div class="subject-card" onclick="startExam('${s.id}')">
                <i class="${s.icon}" style="color:${s.color}; font-size:2rem;"></i>
                <h6 class="mt-2 mb-0 fw-bold" style="font-size:0.85rem;">${s.name}</h6>
            </div>
        `).join('');
    }

    async function startExam(id) {
        const resp = await fetch(`${id}.json`);
        currentQuestions = await resp.json();
        currentSubject = id;
        document.getElementById('sub-label').innerText = id.toUpperCase();
        showSection('exam-hall-view');
        resetExam();
        loadQuestion();
        startTimer();
    }

    function resetExam() {
        currentQuestionIndex = 0; userSelections = {}; flags = {}; timeLeft = 7200;
        document.getElementById('question-palette').innerHTML = currentQuestions.map((_, i) => 
            `<button class="palette-btn" id="p-${i}" onclick="goToQuestion(${i})">${i+1}</button>`).join('');
    }

    function loadQuestion() {
        const q = currentQuestions[currentQuestionIndex];
        const pBox = document.getElementById('passage-container');
        
        // Handling Passages for English
        if (q.passage) {
            pBox.innerHTML = `<strong>Passage:</strong><br>${q.passage}`;
            pBox.style.display = 'block';
        } else {
            pBox.style.display = 'none';
        }

        document.getElementById('question-text').innerHTML = q.q;
        document.getElementById('q-counter').innerText = `Q${currentQuestionIndex + 1}/${currentQuestions.length}`;
        
        document.getElementById('options-container').innerHTML = q.options.map((opt, i) => {
            const letter = String.fromCharCode(97 + i);
            return `<button class="option-btn ${userSelections[currentQuestionIndex] === letter ? 'active' : ''}" 
                    onclick="selectOption('${letter}')">${letter.toUpperCase()}. ${opt}</button>`;
        }).join('');
        
        updatePaletteStyles();
    }

    function selectOption(letter) {
        userSelections[currentQuestionIndex] = letter;
        loadQuestion();
    }

    function updatePaletteStyles() {
        currentQuestions.forEach((_, i) => {
            const btn = document.getElementById(`p-${i}`);
            btn.className = 'palette-btn';
            if (userSelections[i]) btn.classList.add('answered');
            if (flags[i]) btn.classList.add('flagged');
            if (i === currentQuestionIndex) btn.classList.add('current');
        });
    }

    function goToQuestion(i) { currentQuestionIndex = i; loadQuestion(); }
    function nextQuestion() { if(currentQuestionIndex < currentQuestions.length-1) { currentQuestionIndex++; loadQuestion(); }}
    function prevQuestion() { if(currentQuestionIndex > 0) { currentQuestionIndex--; loadQuestion(); }}
    function flagQuestion() { flags[currentQuestionIndex] = !flags[currentQuestionIndex]; updatePaletteStyles(); }

    function startTimer() {
        clearInterval(examTimer);
        examTimer = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft / 60), s = timeLeft % 60;
            document.getElementById('exam-timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
            if (timeLeft <= 0) submitExam(true);
        }, 1000);
    }

    function submitExam(force = false) {
        if (!force && !confirm("Submit Exam?")) return;
        clearInterval(examTimer);
        alert("Exam Submitted! Check Stats for history.");
        showSection('dashboard-view');
    }

    function showSection(id, el) {
        document.querySelectorAll('.app-section').forEach(s => s.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if (el) {
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }
    }
</script>
</body>
</html>
