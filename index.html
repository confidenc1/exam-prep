<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSA JAMB PRO v4.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --jamb-blue: #0d47a1; --accent: #ffd600; --bg: #f4f7f6; }
        body { background: var(--bg); font-family: 'Segoe UI', sans-serif; }
        .header { background: var(--jamb-blue); color: white; padding: 12px; border-bottom: 4px solid var(--accent); position: sticky; top: 0; z-index: 1050; }
        .logo-text { font-weight: 800; letter-spacing: 1px; color: var(--accent); }
        
        /* Dashboard */
        .subject-card { background: white; border-radius: 12px; padding: 15px; cursor: pointer; border: 2px solid transparent; text-align: center; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .subject-card.selected { border-color: #28a745; background: #f0fff4; transform: translateY(-5px); }

        /* Tabs */
        .subject-tabs { background: white; border-bottom: 2px solid #ddd; position: sticky; top: 55px; z-index: 1000; display: flex; overflow-x: auto; }
        .tab-item { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: bold; color: #666; min-width: 100px; }
        .tab-item.active { border-bottom-color: var(--jamb-blue); color: var(--jamb-blue); background: #eef2f7; }

        .option { display: block; width: 100%; padding: 12px; margin-bottom: 8px; border: 1.5px solid #ddd; border-radius: 8px; text-align: left; background: white; transition: 0.2s; }
        .option.selected { background: var(--jamb-blue); color: white; border-color: var(--jamb-blue); }
        .passage-box { background: #fffbe6; border-left: 5px solid #ffc107; padding: 12px; margin-bottom: 15px; max-height: 200px; overflow-y: auto; font-size: 0.9rem; }
        
        #calc-box { display:none; position: fixed; top: 70px; right: 10px; width: 200px; background: #222; padding: 10px; border-radius: 10px; z-index: 2000; }
        .result-card { border-radius: 20px; border: none; overflow: hidden; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; border: 8px solid #28a745; display: flex; align-items: center; justify-content: center; margin: 20px auto; font-size: 2.5rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="header d-flex justify-content-between align-items-center shadow">
    <div class="d-flex align-items-center">
        <span class="logo-text fs-5">FSA-JAMB</span>
    </div>
    <div id="timer" class="fw-bold bg-dark px-2 rounded">02:00:00</div>
    <button class="btn btn-sm btn-warning fw-bold" onclick="toggleCalc()">CALC</button>
</div>

<div id="calc-box" class="shadow text-white">
    <input type="text" id="calc-display" class="form-control mb-2 text-end" readonly>
    <div class="d-flex flex-wrap justify-content-center">
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('7')">7</button>
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('8')">8</button>
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('9')">9</button>
        <button class="btn btn-sm btn-danger m-1" onclick="calcInput('C')">C</button>
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('4')">4</button>
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('5')">5</button>
        <button class="btn btn-sm btn-outline-light m-1" onclick="calcInput('6')">6</button>
        <button class="btn btn-sm btn-warning m-1" onclick="calcInput('*')">Ã—</button>
        <button class="btn btn-sm btn-success w-100 m-1" onclick="calcInput('=')">=</button>
    </div>
</div>

<div class="container mt-3">
    <div id="setup-screen">
        <div class="text-center mb-4">
            <h3>Candidate Portal</h3>
            <p class="text-muted">Pick English + 3 Subjects to begin</p>
        </div>
        <div class="row g-2" id="subject-grid"></div>
        <button id="start-btn" class="btn btn-primary w-100 mt-4 py-3 fw-bold shadow disabled" onclick="beginExam()">GENERATE QUESTION PAPER</button>
    </div>

    <div id="exam-screen" style="display:none;">
        <div class="subject-tabs shadow-sm mb-3" id="tab-container"></div>
        <div class="card p-3 shadow-sm border-0">
            <div class="d-flex justify-content-between mb-2">
                <span id="current-sub-label" class="fw-bold text-primary"></span>
                <span id="q-count" class="badge bg-dark"></span>
            </div>
            <div id="q-container"></div>
            <div class="d-flex justify-content-between mt-4">
                <button class="btn btn-outline-secondary px-4" onclick="moveQ(-1)">PREV</button>
                <button class="btn btn-primary px-4" onclick="moveQ(1)">NEXT</button>
            </div>
        </div>
        <button class="btn btn-success w-100 mt-4 p-3 fw-bold shadow" onclick="finish()">SUBMIT FINISHED EXAM</button>
    </div>

    <div id="result-screen" style="display:none;">
        <div class="card result-card shadow p-4 text-center">
            <h4 class="text-uppercase text-muted">Official Result</h4>
            <div class="score-circle text-success" id="total-score">0</div>
            <h3 id="status-msg" class="mb-4"></h3>
            <div id="breakdown" class="text-start border-top pt-3"></div>
            <button class="btn btn-primary btn-lg w-100 mt-4" onclick="location.reload()">RETAKE MOCK EXAM</button>
        </div>
    </div>
</div>

<script>
    const allSubs = [
        {id:"English", icon:"ðŸ“š"}, {id:"Mathematics", icon:"ðŸ“"}, {id:"Physics", icon:"âš›ï¸"}, 
        {id:"Chemistry", icon:"ðŸ§ª"}, {id:"Biology", icon:"ðŸ§¬"}, {id:"Government", icon:"ðŸ›ï¸"}, 
        {id:"Crk", icon:"ðŸ“–"}, {id:"Economics", icon:"ðŸ“ˆ"}, {id:"Commerce", icon:"ðŸ›’"}, {id:"Accounting", icon:"ðŸ“Š"}
    ];
    let selected = ["English"], examData = {}, activeSub = "English", activeIdx = 0, userAns = {};

    function init() {
        const grid = document.getElementById('subject-grid');
        grid.innerHTML = allSubs.map(s => `
            <div class="col-6"><div class="subject-card ${selected.includes(s.id)?'selected':''}" onclick="toggle('${s.id}')">
                <div class="fs-2">${s.icon}</div><div class="fw-bold">${s.id}</div>
            </div></div>`).join('');
        document.getElementById('start-btn').classList.toggle('disabled', selected.length < 4);
    }

    function toggle(id) {
        if(id === "English") return;
        const i = selected.indexOf(id);
        if(i > -1) selected.splice(i, 1); else if(selected.length < 4) selected.push(id);
        init();
    }

    async function beginExam() {
        const btn = document.getElementById('start-btn');
        btn.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Loading...`;
        for (let s of selected) {
            try {
                const res = await fetch(`${s.toLowerCase()}.json?v=${Date.now()}`);
                examData[s] = await res.json();
                userAns[s] = {};
            } catch(e) { alert("Missing file: " + s.toLowerCase() + ".json"); location.reload(); }
        }
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('exam-screen').style.display = 'block';
        document.getElementById('tab-container').innerHTML = selected.map(s => `<div class="tab-item" id="tab-${s}" onclick="switchTab('${s}')">${s}</div>`).join('');
        switchTab("English");
        startTimer(7200);
    }

    function switchTab(sName) {
        activeSub = sName; activeIdx = 0;
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${sName}`).classList.add('active');
        render();
    }

    function render() {
        const q = examData[activeSub][activeIdx];
        document.getElementById('current-sub-label').innerText = activeSub;
        document.getElementById('q-count').innerText = `Q ${activeIdx + 1} of ${examData[activeSub].length}`;
        let html = q.p ? `<div class="passage-box">${q.p}</div>` : "";
        html += `<p class="fs-5">${q.q}</p>`;
        q.options.forEach((opt, i) => {
            html += `<button class="option ${userAns[activeSub][activeIdx]===i?'selected':''}" onclick="pick(${i})">
                <b>${String.fromCharCode(65+i)}.</b> ${opt}</button>`;
        });
        document.getElementById('q-container').innerHTML = html;
    }

    function pick(i) { userAns[activeSub][activeIdx] = i; render(); }
    function moveQ(d) { if(activeIdx+d >= 0 && activeIdx+d < examData[activeSub].length) { activeIdx += d; render(); } }

    function finish() {
        if(!confirm("Confirm Final Submission?")) return;
        let total = 0, report = "";
        selected.forEach(s => {
            let score = 0;
            examData[s].forEach((q, i) => { if(userAns[s][i] === q.a) score++; });
            let p = Math.round((score / examData[s].length) * 100);
            total += p;
            report += `<div class="d-flex justify-content-between mb-2"><span>${s}</span><span class="fw-bold">${score} Correct (${p}%)</span></div>`;
        });
        
        const finalScore = Math.round(total);
        document.getElementById('total-score').innerText = finalScore;
        document.getElementById('breakdown').innerHTML = report;
        
        let msg = finalScore >= 300 ? "Excellent! You are a genius! ðŸŒŸ" : (finalScore >= 200 ? "Great Job! Highly Admissible! âœ…" : "Keep Studying! You can do it! ðŸ’ª");
        document.getElementById('status-msg').innerText = msg;

        document.getElementById('exam-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
    }

    function startTimer(t) {
        setInterval(() => {
            if(t <= 0) return;
            t--; let h=Math.floor(t/3600), m=Math.floor((t%3600)/60), s=t%60;
            document.getElementById('timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);
    }
    
    function toggleCalc() { const c = document.getElementById('calc-box'); c.style.display = c.style.display==='block'?'none':'block'; }
    function calcInput(v) { 
        const d = document.getElementById('calc-display');
        if(v==='C') d.value=''; else if(v==='=') { try { d.value=eval(d.value); } catch(e) { d.value='Error'; } } else d.value+=v;
    }

    init();
</script>
</body>
</html>
