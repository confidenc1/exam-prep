<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FSA PRO | Elite CBT Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-body: #05060a;
            --surface: #0f111a;
            --surface-light: #161925;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.2);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            --success: #10b981;
            --danger: #ef4444;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
            margin: 0;
        }

        .app-wrapper { display: flex; min-height: 100vh; }

        /* Sidebar Navigation */
        .sidebar {
            width: 320px; background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 2rem; position: sticky; top: 0; height: 100vh;
            display: flex; flex-direction: column;
        }

        .main-content { flex-grow: 1; padding: 2.5rem 5%; background: var(--bg-body); }

        /* Dashboard Components */
        .glass-card { background: var(--surface); border: 1px solid var(--border); border-radius: 24px; padding: 25px; }
        .chart-box { background: var(--surface-light); border-radius: 20px; padding: 25px; border: 1px solid var(--border); }

        /* Subject Selection */
        .sub-pill {
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }
        .sub-pill:hover { transform: translateY(-5px); border-color: var(--accent); }
        .sub-pill.selected { border-color: var(--accent); background: rgba(59, 130, 246, 0.1); box-shadow: 0 0 15px var(--accent-glow); }

        /* Exam Interface */
        .exam-shell {
            max-width: 950px; margin: 0 auto;
            background: var(--surface);
            border-radius: 30px; border: 1px solid var(--border);
            overflow: hidden;
        }

        .sub-bar { display: flex; overflow-x: auto; background: var(--surface-light); border-bottom: 1px solid var(--border); }
        .sub-tab { padding: 18px 25px; color: var(--text-muted); cursor: pointer; font-weight: 600; white-space: nowrap; transition: 0.2s; }
        .sub-tab.active { color: var(--accent); background: rgba(59, 130, 246, 0.05); border-bottom: 3px solid var(--accent); }

        .option-box {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 16px; padding: 18px 25px;
            margin-bottom: 12px; cursor: pointer;
            display: flex; align-items: center; transition: 0.2s;
        }
        .option-box:hover { background: rgba(255,255,255,0.06); }
        .option-box.active { background: var(--accent); border-color: var(--accent); color: white; }
        .option-box.correct { background: var(--success); border-color: var(--success); color: white; }
        .option-box.wrong { background: var(--danger); border-color: var(--danger); color: white; }

        .btn-premium {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            color: white; border: none; padding: 16px 40px;
            border-radius: 50px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-premium:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="app-wrapper">
    <aside class="sidebar d-none d-lg-flex">
        <div class="text-center mb-5">
            <div class="h3 fw-800 mb-4">FSA <span class="text-primary">PRO</span></div>
            <div class="rounded-circle bg-primary mx-auto mb-3" style="width:70px; height:70px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold;">C</div>
            <h5 class="fw-bold mb-0">Confidence</h5>
            <small class="text-muted">Global Ranking: #12</small>
        </div>

        <h6 class="small fw-bold text-muted mb-3 text-uppercase">Leaderboard Top 3</h6>
        <div id="leaderboard" class="small mb-5">
            <div class="d-flex justify-content-between mb-3"><span class="text-muted">1. Tunde J.</span> <b class="text-success">342</b></div>
            <div class="d-flex justify-content-between mb-3"><span class="text-muted">2. Grace E.</span> <b class="text-success">318</b></div>
            <div class="d-flex justify-content-between mb-3"><span class="text-muted">3. Amaka O.</span> <b class="text-success">305</b></div>
            <hr class="border-secondary opacity-25">
            <div class="d-flex justify-content-between text-primary fw-bold"><span>12. You</span> <b id="user-current-rank">-</b></div>
        </div>
        
        <div class="mt-auto">
            <div class="p-3 bg-dark rounded-4 small border border-secondary">
                <i class="fas fa-info-circle me-2"></i> Version 10.1 (Enterprise)
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div id="dashboard-view">
            <div class="d-flex justify-content-between align-items-center mb-5">
                <h2 class="fw-800">CBT Dashboard</h2>
                <div id="timer-display" class="h4 fw-bold text-danger d-none">02:00:00</div>
            </div>

            <div class="chart-box mb-5">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h6 class="fw-bold text-muted mb-0">Performance Trend</h6>
                    <span class="badge bg-primary px-3">Last 5 Exams</span>
                </div>
                <canvas id="historyChart" height="100"></canvas>
            </div>

            <h4 class="fw-bold mb-4">Subject Selection</h4>
            <div class="row g-3 mb-5" id="subject-grid"></div>
            
            <button id="start-btn" class="btn btn-premium btn-lg w-100 disabled shadow-lg" onclick="beginExam()">Initialize Mock Session</button>
        </div>

        <div id="exam-view" style="display:none;">
            <div id="review-tag" class="text-center d-none mb-3">
                <span class="badge bg-warning text-dark p-2 px-5 rounded-pill fw-800"><i class="fas fa-check-double me-2"></i>REVIEW MODE ACTIVE</span>
            </div>
            <div class="exam-shell">
                <div class="sub-bar" id="tab-container"></div>
                <div class="p-4 p-md-5">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 id="current-sub-label" class="fw-800 mb-0">Subject</h4>
                        <div id="q-count" class="badge bg-dark border border-secondary p-2"></div>
                    </div>
                    <div id="q-container" style="min-height: 300px;"></div>
                    <div class="d-flex justify-content-between mt-5">
                        <button class="btn btn-dark rounded-pill px-5 fw-bold" onclick="moveQ(-1)">PREV</button>
                        <button class="btn btn-dark rounded-pill px-5 fw-bold" onclick="moveQ(1)">NEXT</button>
                    </div>
                </div>
            </div>
            <button id="submit-btn" class="btn btn-success w-100 mt-4 py-4 rounded-4 fw-800 shadow-lg" onclick="finish()">FINISH & SUBMIT</button>
            <button id="exit-review" class="btn btn-danger w-100 mt-4 py-3 rounded-4 d-none fw-bold" onclick="location.reload()">EXIT REVIEW MODE</button>
        </div>

        <div id="result-view" style="display:none;" class="text-center py-5">
            <div class="glass-card p-5">
                <h3 class="text-muted fw-bold">TOTAL SCORE</h3>
                <div style="font-size: 7.5rem; font-weight: 900; color: var(--accent); line-height: 1;" id="final-score-val">0</div>
                <div id="breakdown" class="row g-3 mt-5"></div>
                <div class="mt-5 pt-4">
                    <button class="btn btn-outline-info rounded-pill px-5 me-2 py-3 fw-bold" onclick="startReview()">REVIEW CORRECTIONS</button>
                    <button class="btn btn-premium rounded-pill px-5 py-3 fw-bold" onclick="location.reload()">RETAKE EXAM</button>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    let examHistory = JSON.parse(localStorage.getItem('fsa_scores')) || [180, 220, 210, 265, 290];
    const allSubs = [
        {id:"English", icon:"ðŸ“š", req: true}, {id:"Mathematics", icon:"ðŸ“"}, 
        {id:"Physics", icon:"âš›ï¸"}, {id:"Chemistry", icon:"ðŸ§ª"}, 
        {id:"Biology", icon:"ðŸ§¬"}, {id:"Government", icon:"ðŸ›ï¸"}, 
        {id:"Economics", icon:"ðŸ“ˆ"}, {id:"Commerce", icon:"ðŸ›’"},
        {id:"Crk", icon:"ðŸ“–"}, {id:"Accounting", icon:"ðŸ’¼"}
    ];
    let selected = ["English"], examData = {}, activeSub = "English", activeIdx = 0, userAns = {}, isReview = false, timerInterval;

    function initChart() {
        const ctx = document.getElementById('historyChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: examHistory.map((_, i) => `Attempt ${i+1}`),
                datasets: [{
                    data: examHistory,
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.05)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointBackgroundColor: '#3b82f6'
                }]
            },
            options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } } }
        });
    }

    function initDashboard() {
        const grid = document.getElementById('subject-grid');
        grid.innerHTML = allSubs.map(s => `
            <div class="col-md-3 col-6">
                <div class="sub-pill ${selected.includes(s.id)?'selected':''}" onclick="toggle('${s.id}')">
                    <div class="fs-2 mb-2">${s.icon}</div>
                    <div class="fw-bold small">${s.id}</div>
                </div>
            </div>`).join('');
        document.getElementById('start-btn').classList.toggle('disabled', selected.length < 4);
        initChart();
    }

    function toggle(id) {
        if(id === "English") return;
        const i = selected.indexOf(id);
        if(i > -1) selected.splice(i, 1);
        else if(selected.length < 4) selected.push(id);
        initDashboard();
    }

    async function beginExam() {
        for (let s of selected) {
            try {
                const res = await fetch(`${s.toLowerCase()}.json`);
                if (!res.ok) throw new Error();
                examData[s] = await res.json();
                userAns[s] = new Array(examData[s].length).fill(null);
            } catch (e) {
                alert(`Error: ${s.toLowerCase()}.json is missing or corrupted!`);
                return;
            }
        }
        document.getElementById('dashboard-view').style.display = 'none';
        document.getElementById('exam-view').style.display = 'block';
        document.getElementById('tab-container').innerHTML = selected.map(s => 
            `<div class="sub-tab" id="tab-${s}" onclick="switchTab('${s}')">${s}</div>`).join('');
        switchTab("English");
    }

    function switchTab(s) {
        activeSub = s; activeIdx = 0;
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${s}`).classList.add('active');
        render();
    }

    function render() {
        const q = examData[activeSub][activeIdx];
        const correct = q.a;
        const user = userAns[activeSub][activeIdx];
        
        document.getElementById('q-count').innerText = `${activeIdx + 1} / ${examData[activeSub].length}`;
        document.getElementById('current-sub-label').innerText = activeSub;
        
        let html = q.p ? `<div class="p-3 bg-dark rounded-4 mb-4 border border-secondary small text-muted">${q.p}</div>` : '';
        html += `<h4 class="mb-5 fw-bold" style="line-height: 1.6;">${q.q}</h4>`;
        
        q.options.forEach((opt, i) => {
            let cls = "";
            if (isReview) {
                if (i === correct) cls = "correct";
                else if (i === user) cls = "wrong";
                else cls = "opacity-25";
            } else if (user === i) cls = "active";

            html += `<div class="option-box ${cls}" ${isReview ? '' : `onclick="pick(${i})"`}>
                <div class="me-3 fw-bold">${String.fromCharCode(65+i)}.</div> 
                <div class="flex-grow-1">${opt}</div>
                ${isReview && i===correct ? '<i class="fas fa-check-circle ms-auto text-white"></i>' : ''}
                ${isReview && i===user && user!==correct ? '<i class="fas fa-times-circle ms-auto text-white"></i>' : ''}
            </div>`;
        });
        document.getElementById('q-container').innerHTML = html;
    }

    function pick(i) { userAns[activeSub][activeIdx] = i; render(); }
    function moveQ(d) { if(examData[activeSub][activeIdx+d]) { activeIdx += d; render(); } }

    function finish() {
        if(!confirm("Are you sure you want to submit?")) return;
        let total = 0, breakdownHtml = "";
        selected.forEach(s => {
            let correctCount = 0;
            examData[s].forEach((q, i) => { if(userAns[s][i] === q.a) correctCount++; });
            let scaledScore = Math.round((correctCount/examData[s].length)*100);
            total += scaledScore;
            breakdownHtml += `<div class="col-6 col-md-3"><div class="p-3 bg-dark rounded-4 border border-secondary">
                <small class="text-muted fw-bold">${s}</small><br><span class="h5 fw-bold text-primary">${scaledScore}</span></div></div>`;
        });
        
        examHistory.push(total);
        if(examHistory.length > 10) examHistory.shift();
        localStorage.setItem('fsa_scores', JSON.stringify(examHistory));
        
        document.getElementById('final-score-val').innerText = total;
        document.getElementById('breakdown').innerHTML = breakdownHtml;
        document.getElementById('exam-view').style.display = 'none';
        document.getElementById('result-view').style.display = 'block';
    }

    function startReview() {
        isReview = true;
        document.getElementById('result-view').style.display = 'none';
        document.getElementById('exam-view').style.display = 'block';
        document.getElementById('review-tag').classList.remove('d-none');
        document.getElementById('submit-btn').classList.add('d-none');
        document.getElementById('exit-review').classList.remove('d-none');
        switchTab(selected[0]);
    }

    window.onload = initDashboard;
</script>
</body>
    </html>
    
